

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyfcstm.model.expr &mdash; pyfcstm 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=c9d0a6ec" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pyfcstm
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dsl/index.html">PyFCSTM DSL Syntax Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../information/environment.result.html">Run Environment Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/config/index.html">pyfcstm.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/dsl/index.html">pyfcstm.dsl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/entry/index.html">pyfcstm.entry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/model/index.html">pyfcstm.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/render/index.html">pyfcstm.render</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/utils/index.html">pyfcstm.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyfcstm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyfcstm.model.expr</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
    
    
  <h1>Source code for pyfcstm.model.expr</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Expression handling module for mathematical expressions and operations.</span>

<span class="sd">This module provides a comprehensive set of classes for representing and evaluating</span>
<span class="sd">mathematical expressions. It includes support for basic data types (integers, floats, booleans),</span>
<span class="sd">various operators (unary, binary, conditional), mathematical functions, and variables.</span>

<span class="sd">The expression system allows for:</span>

<span class="sd">- Building complex mathematical expressions</span>
<span class="sd">- Evaluating expressions with variable substitution</span>
<span class="sd">- Converting expressions to AST nodes</span>
<span class="sd">- Analyzing expressions to extract variables</span>
<span class="sd">- Handling operator precedence correctly</span>

<span class="sd">All expression classes inherit from the base `Expr` class and implement the AstExportable interface.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">operator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstExportable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..dsl</span><span class="w"> </span><span class="kn">import</span> <span class="n">node</span> <span class="k">as</span> <span class="n">dsl_nodes</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Expr&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Integer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Float&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Boolean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Op&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UnaryOp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BinaryOp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ConditionalOp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UFunc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Variable&#39;</span><span class="p">,</span>
    <span class="s1">&#39;parse_expr_node_to_expr&#39;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="Expr">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Expr">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Expr</span><span class="p">(</span><span class="n">AstExportable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all expressions.</span>

<span class="sd">    This abstract class defines the common interface for all expression types.</span>
<span class="sd">    It provides methods for traversing the expression tree, evaluating expressions,</span>
<span class="sd">    and converting expressions to AST nodes.</span>

<span class="sd">    :rtype: Expr</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_subs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s1">&#39;Expr&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over direct sub-expressions of this expression.</span>

<span class="sd">        :return: Iterator over sub-expressions</span>
<span class="sd">        :rtype: Iterator[Expr]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_all_subs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively iterate over all sub-expressions including this expression.</span>

<span class="sd">        :return: Iterator over all sub-expressions</span>
<span class="sd">        :rtype: Iterator[Expr]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_subs</span><span class="p">():</span>
            <span class="k">yield from</span> <span class="n">sub</span><span class="o">.</span><span class="n">_iter_all_subs</span><span class="p">()</span>

<div class="viewcode-block" id="Expr.list_variables">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Expr.list_variables">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all unique variables used in this expression.</span>

<span class="sd">        :return: List of unique Variable objects</span>
<span class="sd">        :rtype: list[Variable]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vs</span><span class="p">,</span> <span class="n">retval</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_all_subs</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Variable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vs</span><span class="p">:</span>
                <span class="n">retval</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">vs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retval</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal method to evaluate the expression with given variable values.</span>

<span class="sd">        :param kwargs: Variable name to value mapping</span>
<span class="sd">        :return: Result of the expression evaluation</span>
<span class="sd">        :raises NotImplementedError: Must be implemented by subclasses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c1"># pragma: no cover</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the expression with given variable values.</span>

<span class="sd">        :param kwargs: Variable name to value mapping</span>
<span class="sd">        :return: Result of the expression evaluation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get string representation of the expression.</span>

<span class="sd">        :return: String representation</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert this expression to an AST node.</span>

<span class="sd">        :return: AST node representation</span>
<span class="sd">        :rtype: dsl_nodes.Expr</span>
<span class="sd">        :raises NotImplementedError: Must be implemented by subclasses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c1"># pragma: no cover</span></div>



<div class="viewcode-block" id="Integer">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Integer">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Integer</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integer literal expression.</span>

<span class="sd">    :param value: Integer value</span>
<span class="sd">    :type value: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the integer value.</span>

<span class="sd">        :param kwargs: Ignored</span>
<span class="sd">        :return: Integer value</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="Integer.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Integer.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to an Integer AST node.</span>

<span class="sd">        :return: Integer AST node</span>
<span class="sd">        :rtype: dsl_nodes.Integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span></div>
</div>



<div class="viewcode-block" id="Float">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Float">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Float</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Floating point literal expression.</span>

<span class="sd">    :param value: Float value</span>
<span class="sd">    :type value: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the float value.</span>

<span class="sd">        :param kwargs: Ignored</span>
<span class="sd">        :return: Float value</span>
<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="Float.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Float.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to a Float AST node or a Constant node for special values.</span>

<span class="sd">        Recognizes mathematical constants like pi, e, and tau.</span>

<span class="sd">        :return: Float or Constant AST node</span>
<span class="sd">        :rtype: Union[dsl_nodes.Float, dsl_nodes.Constant]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">const_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="n">const_name</span> <span class="o">=</span> <span class="s1">&#39;pi&#39;</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="n">const_name</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="n">const_name</span> <span class="o">=</span> <span class="s1">&#39;tau&#39;</span>

        <span class="k">if</span> <span class="n">const_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="n">const_name</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Boolean">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Boolean">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Boolean</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Boolean literal expression.</span>

<span class="sd">    :param value: Boolean value</span>
<span class="sd">    :type value: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure the value is a boolean.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the boolean value.</span>

<span class="sd">        :param kwargs: Ignored</span>
<span class="sd">        :return: Boolean value</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="Boolean.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Boolean.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to a Boolean AST node.</span>

<span class="sd">        :return: Boolean AST node</span>
<span class="sd">        :rtype: dsl_nodes.Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></div>
</div>



<span class="n">_OP_PRECEDENCE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Parentheses (highest precedence)</span>
    <span class="s2">&quot;()&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>

    <span class="c1"># Function calls</span>
    <span class="s2">&quot;function_call&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>

    <span class="c1"># Unary operators</span>
    <span class="s2">&quot;unary+&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="s2">&quot;unary-&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="s2">&quot;!&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="s2">&quot;not&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>

    <span class="c1"># Exponentiation (right associative)</span>
    <span class="s2">&quot;**&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>

    <span class="c1"># Multiplicative operators</span>
    <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
    <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
    <span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>

    <span class="c1"># Additive operators</span>
    <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>

    <span class="c1"># Bitwise shift operators</span>
    <span class="s2">&quot;&lt;&lt;&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
    <span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>

    <span class="c1"># Bitwise AND</span>
    <span class="s2">&quot;&amp;&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>

    <span class="c1"># Bitwise XOR</span>
    <span class="s2">&quot;^&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>

    <span class="c1"># Bitwise OR</span>
    <span class="s2">&quot;|&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>

    <span class="c1"># Comparison operators</span>
    <span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;==&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;!=&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>

    <span class="c1"># Logical operators</span>
    <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;and&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;||&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;or&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>

    <span class="c1"># Conditional/ternary operator (C-style)</span>
    <span class="s2">&quot;?:&quot;</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">}</span>

<span class="n">_OP_FUNCTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Unary operators</span>
    <span class="s2">&quot;unary+&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
    <span class="s2">&quot;unary-&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span>
    <span class="s2">&quot;!&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
    <span class="s2">&quot;not&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>

    <span class="c1"># Binary operators</span>
    <span class="s2">&quot;**&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span>
    <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span>
    <span class="s2">&quot;/&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">,</span>
    <span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span>
    <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span>
    <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
    <span class="s2">&quot;&lt;&lt;&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">,</span>
    <span class="s2">&quot;&gt;&gt;&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">,</span>
    <span class="s2">&quot;&amp;&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span>
    <span class="s2">&quot;^&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span>
    <span class="s2">&quot;|&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span>
    <span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span>
    <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">,</span>
    <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span>
    <span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span>
    <span class="s2">&quot;==&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
    <span class="s2">&quot;!=&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span>
    <span class="s2">&quot;&amp;&amp;&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
    <span class="s2">&quot;and&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
    <span class="s2">&quot;||&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
    <span class="s2">&quot;or&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>

    <span class="c1"># Ternary operator</span>
    <span class="s2">&quot;?:&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">condition</span><span class="p">,</span> <span class="n">true_value</span><span class="p">,</span> <span class="n">false_value</span><span class="p">:</span> <span class="n">true_value</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">false_value</span>
<span class="p">}</span>


<div class="viewcode-block" id="Op">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Op">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Op</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all operator expressions.</span>

<span class="sd">    This abstract class provides common functionality for operator expressions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">op_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the operator mark for precedence lookup.</span>

<span class="sd">        :return: Operator mark</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        :raises NotImplementedError: Must be implemented by subclasses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c1"># pragma: no cover</span></div>



<div class="viewcode-block" id="BinaryOp">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.BinaryOp">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BinaryOp</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Binary operator expression.</span>

<span class="sd">    :param x: Left operand</span>
<span class="sd">    :type x: Expr</span>
<span class="sd">    :param op: Operator symbol</span>
<span class="sd">    :type op: str</span>
<span class="sd">    :param y: Right operand</span>
<span class="sd">    :type y: Expr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__aliases__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;and&#39;</span><span class="p">:</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;or&#39;</span><span class="p">:</span> <span class="s1">&#39;||&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">x</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Expr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize operator aliases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">op_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the operator mark for precedence lookup.</span>

<span class="sd">        :return: Operator mark</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_subs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over operands.</span>

<span class="sd">        :return: Iterator over operands</span>
<span class="sd">        :rtype: Iterator[Expr]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the binary operation.</span>

<span class="sd">        :param kwargs: Variable name to value mapping</span>
<span class="sd">        :return: Result of the operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_OP_FUNCTIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_mark</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<div class="viewcode-block" id="BinaryOp.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.BinaryOp.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to a BinaryOp AST node.</span>

<span class="sd">        Handles operator precedence by adding parentheses where needed.</span>

<span class="sd">        :return: BinaryOp AST node</span>
<span class="sd">        :rtype: dsl_nodes.BinaryOp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>

        <span class="n">left_need_paren</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
            <span class="n">left_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">left_pre</span> <span class="o">&lt;</span> <span class="n">my_pre</span><span class="p">:</span>
                <span class="n">left_need_paren</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">right_need_paren</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
            <span class="n">right_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">right_pre</span> <span class="o">&lt;=</span> <span class="n">my_pre</span><span class="p">:</span>
                <span class="n">right_need_paren</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">left_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">left_need_paren</span><span class="p">:</span>
            <span class="n">left_term</span> <span class="o">=</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Paren</span><span class="p">(</span><span class="n">left_term</span><span class="p">)</span>
        <span class="n">right_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">right_need_paren</span><span class="p">:</span>
            <span class="n">right_term</span> <span class="o">=</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Paren</span><span class="p">(</span><span class="n">right_term</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">BinaryOp</span><span class="p">(</span>
            <span class="n">expr1</span><span class="o">=</span><span class="n">left_term</span><span class="p">,</span>
            <span class="n">op</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
            <span class="n">expr2</span><span class="o">=</span><span class="n">right_term</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="UnaryOp">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.UnaryOp">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UnaryOp</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unary operator expression.</span>

<span class="sd">    :param op: Operator symbol</span>
<span class="sd">    :type op: str</span>
<span class="sd">    :param x: Operand</span>
<span class="sd">    :type x: Expr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__aliases__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;not&#39;</span><span class="p">:</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">op</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">Expr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize operator aliases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aliases__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">op_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the operator mark for precedence lookup.</span>

<span class="sd">        :return: Operator mark</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;unary</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">}</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_subs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over operands.</span>

<span class="sd">        :return: Iterator over operands</span>
<span class="sd">        :rtype: Iterator[Expr]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the unary operation.</span>

<span class="sd">        :param kwargs: Variable name to value mapping</span>
<span class="sd">        :return: Result of the operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_OP_FUNCTIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_mark</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<div class="viewcode-block" id="UnaryOp.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.UnaryOp.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to a UnaryOp AST node.</span>

<span class="sd">        Handles operator precedence by adding parentheses where needed.</span>

<span class="sd">        :return: UnaryOp AST node</span>
<span class="sd">        :rtype: dsl_nodes.UnaryOp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>
        <span class="n">x_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
            <span class="n">value_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">value_pre</span> <span class="o">&lt;=</span> <span class="n">my_pre</span><span class="p">:</span>
                <span class="n">x_node</span> <span class="o">=</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Paren</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">x_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">x_node</span><span class="p">)</span></div>
</div>



<span class="n">_MATH_FUNCTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Trigonometric functions</span>
    <span class="s2">&quot;sin&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span>
    <span class="s2">&quot;cos&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">,</span>
    <span class="s2">&quot;tan&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
    <span class="s2">&quot;asin&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">,</span>
    <span class="s2">&quot;acos&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">,</span>
    <span class="s2">&quot;atan&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">,</span>

    <span class="c1"># Hyperbolic functions</span>
    <span class="s2">&quot;sinh&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sinh</span><span class="p">,</span>
    <span class="s2">&quot;cosh&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">cosh</span><span class="p">,</span>
    <span class="s2">&quot;tanh&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">tanh</span><span class="p">,</span>
    <span class="s2">&quot;asinh&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">asinh</span><span class="p">,</span>
    <span class="s2">&quot;acosh&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">acosh</span><span class="p">,</span>
    <span class="s2">&quot;atanh&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">atanh</span><span class="p">,</span>

    <span class="c1"># Root and power functions</span>
    <span class="s2">&quot;sqrt&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span>
    <span class="s2">&quot;cbrt&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span>  <span class="c1"># Cube root implementation</span>
    <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span>

    <span class="c1"># Logarithmic functions</span>
    <span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>  <span class="c1"># Natural logarithm (base e)</span>
    <span class="s2">&quot;log10&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">,</span>
    <span class="s2">&quot;log2&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">,</span>
    <span class="s2">&quot;log1p&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span>  <span class="c1"># log(1+x)</span>

    <span class="c1"># Rounding and absolute value functions</span>
    <span class="s2">&quot;abs&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">,</span>  <span class="c1"># Python&#39;s built-in abs function</span>
    <span class="s2">&quot;ceil&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">,</span>
    <span class="s2">&quot;floor&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span>
    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">,</span>  <span class="c1"># Python&#39;s built-in round function</span>
    <span class="s2">&quot;trunc&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">,</span>

    <span class="c1"># Sign function</span>
    <span class="s2">&quot;sign&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Returns the sign of x</span>
<span class="p">}</span>


<div class="viewcode-block" id="UFunc">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.UFunc">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">UFunc</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mathematical function expression.</span>

<span class="sd">    Represents calls to mathematical functions like sin, cos, sqrt, etc.</span>

<span class="sd">    :param func: Function name</span>
<span class="sd">    :type func: str</span>
<span class="sd">    :param x: Function argument</span>
<span class="sd">    :type x: Expr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">func</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">Expr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_subs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over function arguments.</span>

<span class="sd">        :return: Iterator over arguments</span>
<span class="sd">        :rtype: Iterator[Expr]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the function.</span>

<span class="sd">        :param kwargs: Variable name to value mapping</span>
<span class="sd">        :return: Result of the function call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_MATH_FUNCTIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<div class="viewcode-block" id="UFunc.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.UFunc.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to a UFunc AST node.</span>

<span class="sd">        :return: UFunc AST node</span>
<span class="sd">        :rtype: dsl_nodes.UFunc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UFunc</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="ConditionalOp">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.ConditionalOp">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConditionalOp</span><span class="p">(</span><span class="n">Op</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conditional (ternary) operator expression.</span>

<span class="sd">    :param cond: Condition expression</span>
<span class="sd">    :type cond: Expr</span>
<span class="sd">    :param if_true: Expression to evaluate if condition is true</span>
<span class="sd">    :type if_true: Expr</span>
<span class="sd">    :param if_false: Expression to evaluate if condition is false</span>
<span class="sd">    :type if_false: Expr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cond</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">if_true</span><span class="p">:</span> <span class="n">Expr</span>
    <span class="n">if_false</span><span class="p">:</span> <span class="n">Expr</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">op_mark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the operator mark for precedence lookup.</span>

<span class="sd">        :return: Operator mark</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;?:&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_iter_subs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate over sub-expressions.</span>

<span class="sd">        :return: Iterator over sub-expressions</span>
<span class="sd">        :rtype: Iterator[Expr]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_true</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_false</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the conditional operation.</span>

<span class="sd">        :param kwargs: Variable name to value mapping</span>
<span class="sd">        :return: Result of either if_true or if_false based on condition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cond_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cond_value</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_true</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_false</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ConditionalOp.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.ConditionalOp.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to a ConditionalOp AST node.</span>

<span class="sd">        Handles operator precedence by adding parentheses where needed.</span>

<span class="sd">        :return: ConditionalOp AST node</span>
<span class="sd">        :rtype: dsl_nodes.ConditionalOp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>

        <span class="n">true_need_paren</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_true</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
            <span class="n">true_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">if_true</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">true_pre</span> <span class="o">&lt;=</span> <span class="n">my_pre</span><span class="p">:</span>
                <span class="n">true_need_paren</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">false_need_paren</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">if_false</span><span class="p">,</span> <span class="n">Op</span><span class="p">):</span>
            <span class="n">false_pre</span> <span class="o">=</span> <span class="n">_OP_PRECEDENCE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">if_false</span><span class="o">.</span><span class="n">op_mark</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">false_pre</span> <span class="o">&lt;=</span> <span class="n">my_pre</span><span class="p">:</span>
                <span class="n">false_need_paren</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">cond_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">()</span>
        <span class="n">true_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_true</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">true_need_paren</span><span class="p">:</span>
            <span class="n">true_term</span> <span class="o">=</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Paren</span><span class="p">(</span><span class="n">true_term</span><span class="p">)</span>
        <span class="n">false_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_false</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">false_need_paren</span><span class="p">:</span>
            <span class="n">false_term</span> <span class="o">=</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Paren</span><span class="p">(</span><span class="n">false_term</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">ConditionalOp</span><span class="p">(</span>
            <span class="n">cond</span><span class="o">=</span><span class="n">cond_term</span><span class="p">,</span>
            <span class="n">value_true</span><span class="o">=</span><span class="n">true_term</span><span class="p">,</span>
            <span class="n">value_false</span><span class="o">=</span><span class="n">false_term</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Variable">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Variable">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Variable</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Variable reference expression.</span>

<span class="sd">    :param name: Variable name</span>
<span class="sd">    :type name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lookup the variable value from kwargs.</span>

<span class="sd">        :param kwargs: Variable name to value mapping</span>
<span class="sd">        :return: Variable value</span>
<span class="sd">        :raises KeyError: If variable name is not found in kwargs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

<div class="viewcode-block" id="Variable.to_ast_node">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.Variable.to_ast_node">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_ast_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert to a Name AST node.</span>

<span class="sd">        :return: Name AST node</span>
<span class="sd">        :rtype: dsl_nodes.Name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="parse_expr_node_to_expr">
<a class="viewcode-back" href="../../../api_doc/model/expr.html#pyfcstm.model.expr.parse_expr_node_to_expr">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse an AST expression node into an Expr object.</span>

<span class="sd">    This function converts DSL expression nodes into the corresponding expression objects.</span>

<span class="sd">    :param node: AST expression node</span>
<span class="sd">    :type node: dsl_nodes.Expr</span>
<span class="sd">    :return: Corresponding expression object</span>
<span class="sd">    :rtype: Expr</span>
<span class="sd">    :raises TypeError: If the node type is not recognized</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; ast_node = dsl_nodes.Integer(raw=&quot;42&quot;)</span>
<span class="sd">        &gt;&gt;&gt; expr = parse_expr_node_to_expr(ast_node)</span>
<span class="sd">        &gt;&gt;&gt; isinstance(expr, Integer)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; expr.value</span>
<span class="sd">        42</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">HexInt</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Constant</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Float</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">Float</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Boolean</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Boolean</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Paren</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UnaryOp</span><span class="p">(</span>
            <span class="n">op</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">BinaryOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">BinaryOp</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr1</span><span class="p">),</span>
            <span class="n">op</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr2</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">ConditionalOp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ConditionalOp</span><span class="p">(</span>
            <span class="n">cond</span><span class="o">=</span><span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">cond</span><span class="p">),</span>
            <span class="n">if_true</span><span class="o">=</span><span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value_true</span><span class="p">),</span>
            <span class="n">if_false</span><span class="o">=</span><span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value_false</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UFunc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">UFunc</span><span class="p">(</span>
            <span class="n">func</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">parse_expr_node_to_expr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">expr</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown node type - </span><span class="si">{</span><span class="n">node</span><span class="si">!r}</span><span class="s1">.&#39;</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span></div>

</pre></div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, HansBug.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.1.1
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="../../../../v0.0.1/index.html">v0.0.1</a></dd>
                        <dd><a href="../../../../v0.1.0/index.html">v0.1.0</a></dd>
                        <dd><a href="expr.html">v0.1.1</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="../../../../HEAD/index.html">HEAD</a></dd>
                        <dd><a href="../../../../main/index.html">main</a></dd>
                        <dd><a href="../../../../old_design/index.html">old_design</a></dd>
                </dl>
        </div>
    </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>