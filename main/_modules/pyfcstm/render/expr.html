

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyfcstm.render.expr &mdash; pyfcstm 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=c9d0a6ec" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pyfcstm
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/dsl/index.html">PyFCSTM DSL Syntax Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../information/environment.result.html">Run Environment Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/config/index.html">pyfcstm.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/dsl/index.html">pyfcstm.dsl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/entry/index.html">pyfcstm.entry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/model/index.html">pyfcstm.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/render/index.html">pyfcstm.render</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc/utils/index.html">pyfcstm.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyfcstm</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyfcstm.render.expr</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
    
    
  <h1>Source code for pyfcstm.render.expr</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Expression rendering module for converting DSL nodes to different language formats.</span>

<span class="sd">This module provides functionality to render expression nodes in various language styles</span>
<span class="sd">including DSL, C/C++, and Python. It uses Jinja2 templating to transform abstract syntax</span>
<span class="sd">tree nodes into string representations according to the specified language style.</span>

<span class="sd">The module contains predefined templates for different node types and operators,</span>
<span class="sd">and allows for custom template extensions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jinja2</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.env</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_env</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..dsl</span><span class="w"> </span><span class="kn">import</span> <span class="n">node</span> <span class="k">as</span> <span class="n">dsl_nodes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Boolean</span>

<span class="n">_DSL_STYLE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Float&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.value | repr }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Integer&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.value | repr }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Boolean&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.value | repr }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Constant&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.value | repr }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HexInt&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.value | hex }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Paren&#39;</span><span class="p">:</span> <span class="s1">&#39;({{ node.expr | expr_render }})&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UFunc&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.func }}({{ node.expr | expr_render }})&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.name }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UnaryOp&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.op }}{{ node.expr | expr_render }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BinaryOp&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.expr1 | expr_render }} {{ node.op }} {{ node.expr2 | expr_render }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ConditionalOp&#39;</span><span class="p">:</span> <span class="s1">&#39;({{ node.cond | expr_render }}) ? {{ node.value_true | expr_render }} : {{ node.value_false | expr_render }}&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_C_STYLE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">**</span><span class="n">_DSL_STYLE</span><span class="p">,</span>
    <span class="s1">&#39;Boolean&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ (1 if node.value else 0) | hex }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BinaryOp(**)&#39;</span><span class="p">:</span> <span class="s1">&#39;pow({{ node.expr1 | expr_render }}, {{ node.expr2 | expr_render }})&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_PY_STYLE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">**</span><span class="n">_DSL_STYLE</span><span class="p">,</span>
    <span class="s1">&#39;UFunc&#39;</span><span class="p">:</span> <span class="s1">&#39;math.{{ node.func }}({{ node.expr | expr_render }})&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UnaryOp(!)&#39;</span><span class="p">:</span> <span class="s1">&#39;not {{ node.expr | expr_render }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BinaryOp(&amp;&amp;)&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.expr1 | expr_render }} and {{ node.expr2 | expr_render }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;BinaryOp(||)&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.expr1 | expr_render }} or {{ node.expr2 | expr_render }}&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ConditionalOp&#39;</span><span class="p">:</span> <span class="s1">&#39;{{ node.value_true | expr_render }} if {{ node.cond | expr_render }} else {{ node.value_false | expr_render }}&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_KNOWN_STYLES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dsl&#39;</span><span class="p">:</span> <span class="n">_DSL_STYLE</span><span class="p">,</span>
    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">_C_STYLE</span><span class="p">,</span>
    <span class="s1">&#39;cpp&#39;</span><span class="p">:</span> <span class="n">_C_STYLE</span><span class="p">,</span>
    <span class="s1">&#39;python&#39;</span><span class="p">:</span> <span class="n">_PY_STYLE</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="fn_expr_render">
<a class="viewcode-back" href="../../../api_doc/render/expr.html#pyfcstm.render.expr.fn_expr_render">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fn_expr_render</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">templates</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                   <span class="n">env</span><span class="p">:</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render an expression node using the provided templates and Jinja2 environment.</span>

<span class="sd">    This function handles different types of expression nodes and selects the appropriate</span>
<span class="sd">    template for rendering based on the node type and available templates.</span>

<span class="sd">    :param node: The expression node to render, can be a DSL node or a primitive value</span>
<span class="sd">    :type node: Union[float, int, dict, dsl_nodes.Expr, Any]</span>

<span class="sd">    :param templates: Dictionary mapping node types to Jinja2 template strings</span>
<span class="sd">    :type templates: Dict[str, str]</span>

<span class="sd">    :param env: Jinja2 environment for template rendering</span>
<span class="sd">    :type env: jinja2.Environment</span>

<span class="sd">    :return: The rendered string representation of the expression node</span>
<span class="sd">    :rtype: str</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; env = create_env()</span>
<span class="sd">        &gt;&gt;&gt; templates = _DSL_STYLE</span>
<span class="sd">        &gt;&gt;&gt; fn_expr_render(Integer(42).to_ast_node(), templates, env)</span>
<span class="sd">        &#39;42&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">(</span><span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Float</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Constant</span><span class="p">,</span>
                             <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">HexInt</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Paren</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">ConditionalOp</span><span class="p">))</span> \
                <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UFunc</span><span class="p">)</span> <span class="ow">and</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UFunc</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">)</span> <span class="ow">and</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">BinaryOp</span><span class="p">)</span> <span class="ow">and</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">BinaryOp</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template_str</span> <span class="o">=</span> <span class="n">templates</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>

        <span class="n">tp</span><span class="p">:</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">template_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tp</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fn_expr_render</span><span class="p">(</span><span class="n">Boolean</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">(),</span> <span class="n">templates</span><span class="o">=</span><span class="n">templates</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fn_expr_render</span><span class="p">(</span><span class="n">Integer</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">(),</span> <span class="n">templates</span><span class="o">=</span><span class="n">templates</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fn_expr_render</span><span class="p">(</span><span class="n">Float</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">to_ast_node</span><span class="p">(),</span> <span class="n">templates</span><span class="o">=</span><span class="n">templates</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_expr_render_template">
<a class="viewcode-back" href="../../../api_doc/render/expr.html#pyfcstm.render.expr.create_expr_render_template">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_expr_render_template</span><span class="p">(</span><span class="n">lang_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dsl&#39;</span><span class="p">,</span> <span class="n">ext_configs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a template dictionary for expression rendering based on the specified language style.</span>

<span class="sd">    This function combines the predefined templates for the specified language style with</span>
<span class="sd">    any additional custom templates provided in ext_configs.</span>

<span class="sd">    :param lang_style: The language style to use (&#39;dsl&#39;, &#39;c&#39;, &#39;cpp&#39;, &#39;python&#39;)</span>
<span class="sd">    :type lang_style: str</span>

<span class="sd">    :param ext_configs: Optional additional template configurations to extend or override defaults</span>
<span class="sd">    :type ext_configs: Optional[Dict[str, str]]</span>

<span class="sd">    :return: A dictionary of templates for the specified language style</span>
<span class="sd">    :rtype: Dict[str, str]</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; templates = create_expr_render_template(&#39;python&#39;, {&#39;CustomNode&#39;: &#39;{{ node.custom_value }}&#39;})</span>
<span class="sd">        &gt;&gt;&gt; &#39;UFunc&#39; in templates and &#39;CustomNode&#39; in templates</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">_KNOWN_STYLES</span><span class="p">[</span><span class="n">lang_style</span><span class="p">],</span> <span class="o">**</span><span class="p">(</span><span class="n">ext_configs</span> <span class="ow">or</span> <span class="p">{})}</span></div>



<div class="viewcode-block" id="render_expr_node">
<a class="viewcode-back" href="../../../api_doc/render/expr.html#pyfcstm.render.expr.render_expr_node">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">render_expr_node</span><span class="p">(</span><span class="n">expr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dsl_nodes</span><span class="o">.</span><span class="n">Expr</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                     <span class="n">lang_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;dsl&#39;</span><span class="p">,</span> <span class="n">ext_configs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render an expression node to a string representation in the specified language style.</span>

<span class="sd">    This is a high-level function that sets up the environment and renders the expression</span>
<span class="sd">    in one step. It&#39;s a convenient wrapper around add_expr_render_to_env and fn_expr_render.</span>

<span class="sd">    :param expr: The expression to render</span>
<span class="sd">    :type expr: Union[float, int, dict, dsl_nodes.Expr, Any]</span>

<span class="sd">    :param lang_style: The language style to use (&#39;dsl&#39;, &#39;c&#39;, &#39;cpp&#39;, &#39;python&#39;)</span>
<span class="sd">    :type lang_style: str</span>

<span class="sd">    :param ext_configs: Optional additional template configurations</span>
<span class="sd">    :type ext_configs: Optional[Dict[str, str]]</span>

<span class="sd">    :param env: Optional pre-configured Jinja2 environment</span>
<span class="sd">    :type env: Optional[jinja2.Environment]</span>

<span class="sd">    :return: The rendered string representation of the expression</span>
<span class="sd">    :rtype: str</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; from pyfcstm.dsl import Integer</span>
<span class="sd">        &gt;&gt;&gt; render_expr_node(Integer(&#39;42&#39;), lang_style=&#39;python&#39;)</span>
<span class="sd">        &#39;42&#39;</span>
<span class="sd">        &gt;&gt;&gt; render_expr_node(Integer(&#39;42&#39;), lang_style=&#39;c&#39;)</span>
<span class="sd">        &#39;42&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">env</span> <span class="ow">or</span> <span class="n">create_env</span><span class="p">()</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="n">create_expr_render_template</span><span class="p">(</span><span class="n">lang_style</span><span class="p">,</span> <span class="n">ext_configs</span><span class="p">)</span>
    <span class="n">_fn_expr_render</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">fn_expr_render</span><span class="p">,</span> <span class="n">templates</span><span class="o">=</span><span class="n">templates</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s1">&#39;expr_render&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_fn_expr_render</span>
    <span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="s1">&#39;expr_render&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_fn_expr_render</span>
    <span class="k">return</span> <span class="n">_fn_expr_render</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">expr</span><span class="p">)</span></div>

</pre></div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, HansBug.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: main
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="../../../../v0.0.1/index.html">v0.0.1</a></dd>
                        <dd><a href="../../../../v0.1.0/index.html">v0.1.0</a></dd>
                        <dd><a href="../../../../v0.1.1/index.html">v0.1.1</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="../../../../dev/fix_plantuml/index.html">dev/fix_plantuml</a></dd>
                        <dd><a href="../../../../HEAD/index.html">HEAD</a></dd>
                        <dd><a href="expr.html">main</a></dd>
                        <dd><a href="../../../../old_design/index.html">old_design</a></dd>
                </dl>
        </div>
    </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>